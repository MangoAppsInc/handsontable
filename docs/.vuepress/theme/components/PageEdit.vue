<template>
  <footer class="footer">
    <div class="footer-support">
      <div
        v-if="editLink"
        class="edit-link"
      >
        <a
          :href="editLink"
          target="_blank"
          rel="noopener noreferrer"
        >{{ editLinkText }} <i class="ico i-external"></i> </a>
      </div>
    </div>

    <div class="hot-feedback">
      <div class="_hj_feedback_container" id="widget-410849"><div class="_hj-s3UIi__styles__globalStyles _hj-Pbej5__styles__resetStyles _hj-1rd6z__styles__embeddedContainer"><div class="_hj-YR-2H__Feedback__container _hj-soF-G__Feedback__isEmbedded" style="--hjFeedbackAccentColor: #2556f2; --hjFeedbackAccentHoverColor: #0d3cd7; --hjFeedbackAccentActiveColor: #0b35bf; --hjFeedbackAccentTextColor: #ffffff; --hjFeedbackDisabledAccentColor: #F1F2F6; --hjFeedbackDisabledAccentTextColor: rgba(0, 0, 0, 0.43); --hjFeedbackSecondaryTextColor: #666666; --hjFeedbackBackgroundColor: #ffffff; --hjFeedbackDarkGray: #333333; --hjFeedbackSelectionColor: #ffd902; --hjFeedbackSelectionTextColor: #3c3c3c; --hjFeedbackBorderColor: #E4E6EB; --hjFeedbackOptionButtonBackgroundColor: #e6e6e6; --hjFeedbackInputPlaceholderColor: #677195; font-size: clamp(16px, 1rem, 32px) !important;"><div id="_hj_feedback_container" class="_hj-zRk2h__Feedback__feedback"><div class="_hj-lOIQj__ExpandedWidget__outerContainer _hj-FZpS-__ExpandedWidget__right _hj-Nf6vN__ExpandedWidget__bottom _hj-ivniz__ExpandedWidget__inline _hj-dLkgL__ExpandedWidget__slideInRight _hj-q-8RD__ExpandedWidget__isEmbedded"><div class="_hj--NfhW__ExpandedWidget__innerContainer _hj-q-8RD__ExpandedWidget__isEmbedded"><div class="_hj-sMYdO__EmotionStep__EmotionStep _hj-atUfw__EmotionStep__isEmbedded"><p class="_hj-Z5Onj__Title__Title _hj-9ZlKs__Title__compact _hj-8VPIr__Title__isEmbedded">How would you rate your experience?</p><div class="_hj-4Eap5__EmotionStep__EmotionOptions"><button aria-label="Hate" class="_hj-zyNAL__EmotionOption__EmotionOption _hj-exLiv__EmotionOption__fadeIn _hj-vWDAR__EmotionOption__isEmbedded"><div class="_hj-8MJin__EmotionOption__iconEmotion _hj-NNI6w__EmotionOption__hate _hj-wJAZj__EmotionOption__iconEmotionStar _hj-vWDAR__EmotionOption__isEmbedded"><span class="_hj--GlAE__EmotionOption__commentIcon"></span><span class="_hj-tLbak__EmotionOption__expressionIcon"></span></div><div class="_hj-c-jt7__EmotionOption__EmotionText _hj-vvXwd__EmotionOption__EmotionTextStar">Hate</div></button><button aria-label="Dislike" class="_hj-zyNAL__EmotionOption__EmotionOption _hj-exLiv__EmotionOption__fadeIn _hj-vWDAR__EmotionOption__isEmbedded"><div class="_hj-8MJin__EmotionOption__iconEmotion _hj-1Invx__EmotionOption__dislike _hj-wJAZj__EmotionOption__iconEmotionStar _hj-vWDAR__EmotionOption__isEmbedded"><span class="_hj--GlAE__EmotionOption__commentIcon"></span><span class="_hj-tLbak__EmotionOption__expressionIcon"></span></div><div class="_hj-c-jt7__EmotionOption__EmotionText _hj-vvXwd__EmotionOption__EmotionTextStar">Dislike</div></button><button aria-label="Neutral" class="_hj-zyNAL__EmotionOption__EmotionOption _hj-exLiv__EmotionOption__fadeIn _hj-vWDAR__EmotionOption__isEmbedded"><div class="_hj-8MJin__EmotionOption__iconEmotion _hj-Qztfe__EmotionOption__neutral _hj-wJAZj__EmotionOption__iconEmotionStar _hj-vWDAR__EmotionOption__isEmbedded"><span class="_hj--GlAE__EmotionOption__commentIcon"></span><span class="_hj-tLbak__EmotionOption__expressionIcon"></span></div><div class="_hj-c-jt7__EmotionOption__EmotionText _hj-vvXwd__EmotionOption__EmotionTextStar">Neutral</div></button><button aria-label="Like" class="_hj-zyNAL__EmotionOption__EmotionOption _hj-exLiv__EmotionOption__fadeIn _hj-vWDAR__EmotionOption__isEmbedded"><div class="_hj-8MJin__EmotionOption__iconEmotion _hj-EwQ-L__EmotionOption__like _hj-wJAZj__EmotionOption__iconEmotionStar _hj-vWDAR__EmotionOption__isEmbedded"><span class="_hj--GlAE__EmotionOption__commentIcon"></span><span class="_hj-tLbak__EmotionOption__expressionIcon"></span></div><div class="_hj-c-jt7__EmotionOption__EmotionText _hj-vvXwd__EmotionOption__EmotionTextStar">Like</div></button><button aria-label="Love" class="_hj-zyNAL__EmotionOption__EmotionOption _hj-exLiv__EmotionOption__fadeIn _hj-vWDAR__EmotionOption__isEmbedded"><div class="_hj-8MJin__EmotionOption__iconEmotion _hj-OxvxV__EmotionOption__love _hj-wJAZj__EmotionOption__iconEmotionStar _hj-vWDAR__EmotionOption__isEmbedded"><span class="_hj--GlAE__EmotionOption__commentIcon"></span><span class="_hj-tLbak__EmotionOption__expressionIcon"></span></div><div class="_hj-c-jt7__EmotionOption__EmotionText _hj-vvXwd__EmotionOption__EmotionTextStar">Love</div></button></div><div class="_hj-9Mvlt__EmotionStep__EmotionFooter _hj-atUfw__EmotionStep__isEmbedded _hj-RIAug__EmotionStep__noBranding"></div></div></div></div></div></div></div></div>
    </div>

    <div class="footer-links">
      <div class="socail-links">
        <a href="https://github.com/handsontable/handsontable" target="_blank" aria-label="Link to Github">
          <i class="ico i-github"></i>
        </a>
        <a href="https://www.linkedin.com/company/handsontable/" target="_blank" aria-label="Link to Linkedin">
          <i class="ico i-linkedin"></i>
        </a>
        <a href="https://twitter.com/handsontable" target="_blank" aria-label="Link to X">
          <i class="ico i-twitter"></i>
        </a>
      </div>

      <div class="hot-links">
        <a href="https://handsontable.com/privacy">Privacy policy</a>
        <a href="https://handsontable.com/terms-of-use">Terms of use</a>
        <a href="https://handsontable.com/team">Team</a>
        <a href="https://handsontable.com/contact?category=technical_support">Contact</a>

        <a href="https://handsontable.com/blog/">Blog</a>
        <a href="https://status.handsontable.com/" target="_blank" class="status">Status</a>
      </div>
    </div>

    <div class="copyright">
      <p>Â© {{ new Date().getFullYear() }} Handsoncode</p>
      <ThemeSwitcher />
    </div>
  </footer>
</template>

<script>
import isNil from 'lodash/isNil';
import { endingSlashRE, outboundRE } from '@vuepress/theme-default/util';
import ThemeSwitcher from '@theme/components/ThemeSwitcher.vue';

export default {
  name: 'PageEdit',
  components: {
    ThemeSwitcher
  },

  computed: {
    lastUpdated() {
      return this.$page.lastUpdatedFormat;
    },

    lastUpdatedText() {
      if (typeof this.$themeLocaleConfig.lastUpdated === 'string') {
        return this.$themeLocaleConfig.lastUpdated;
      }
      if (typeof this.$site.themeConfig.lastUpdated === 'string') {
        return this.$site.themeConfig.lastUpdated;
      }

      return 'Last update';
    },

    editLink() {
      const showEditLink = isNil(this.$page.frontmatter.editLink)
        ? this.$site.themeConfig.editLinks
        : this.$page.frontmatter.editLink;

      const {
        repo,
        docsDir = '',
        docsBranch = 'master',
        docsRepo = repo
      } = this.$site.themeConfig;

      if (showEditLink && docsRepo && this.$page.originRelativePath) {
        return this.createEditLink(
          repo,
          docsRepo,
          docsDir,
          docsBranch,
          this.$page.originRelativePath
        );
      }

      return null;
    },

    editLinkText() {
      return (
        this.$themeLocaleConfig.editLinkText
        || this.$site.themeConfig.editLinkText
        || 'Improve this page'
      );
    }
  },

  methods: {
    createEditLink(repo, docsRepo, docsDir, docsBranch, path) {
      const bitbucket = /bitbucket.org/;

      if (bitbucket.test(docsRepo)) {
        const base = docsRepo;

        return (
          `${base.replace(endingSlashRE, '')}/src/${docsBranch}/${docsDir
            ? `${docsDir.replace(endingSlashRE, '')}/`
            : ''}${path}?mode=edit&spa=0&at=${docsBranch}&fileviewer=file-view-default`
        );
      }

      const gitlab = /gitlab.com/;

      if (gitlab.test(docsRepo)) {
        const base = docsRepo;

        return (
          `${base.replace(endingSlashRE, '')}/-/edit/${docsBranch}/${docsDir
            ? `${docsDir.replace(endingSlashRE, '')}/`
            : ''}${path}`
        );
      }

      const base = outboundRE.test(docsRepo)
        ? docsRepo
        : `https://github.com/${docsRepo}`;

      return (
        `${base.replace(endingSlashRE, '')}/edit/${docsBranch}/${docsDir
          ? `${docsDir.replace(endingSlashRE, '')}/`
          : ''}${path}`
      );
    }
  }
};
</script>